name: "Bot Commit & Push"
description: "Commit and push changes with github-actions[bot]"

inputs:
  module:
    required: true
    description: "Notion Workspace name"
  scope:
    required: true
    description: "Scope of Module"

runs:
  using: "composite"
  steps:
    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '25'

    - name: Run ${{ inputs.module }} ${{ inputs.scope }}
      run: ./gradlew :${{ inputs.scope }}:bootRun
      shell: bash

    - name: Commit & Push
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

        git add storage/
        git commit \
          -m "chore(${{ inputs.scope }}): ${{ inputs.scope }} Notion JSONs at $(date -u +'%Y-%m-%d %H:%M:%S')" \
          -m "$(git diff --cached --name-status)" \
          || echo "âœ… No changes to commit"
        git subtree push --prefix storage \
        "https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/wliamp/notion-storage-${{ inputs.module }}.git" \
        main
      shell: bash
